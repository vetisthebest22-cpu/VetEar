<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VetPulse - AI Veterinary Sound Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/speech-commands/dist/speech-commands.min.js"></script>
    <style>
        /* Paste all your VetPulse CSS here without changes */
        /* ... existing CSS from your VetPulse code ... */
    </style>
</head>
<body>
    <!-- Paste all your existing VetPulse HTML here -->
    <!-- ... header, hero section, progress-section, descriptions-section, recommendations, footer ... -->

    <script>
        const MODEL_URL = './my_model/'; // Your model path
        let recognizer;
        let lastScores = [0,0,0,0];
        let classLabels = [];
        let isListening = false;

        async function loadModel() {
            recognizer = speechCommands.create('BROWSER_FFT', undefined, MODEL_URL+'model.json', MODEL_URL+'metadata.json');
            await recognizer.ensureModelLoaded();
            classLabels = recognizer.wordLabels();
            console.log('Model loaded:', classLabels);
        }

        async function startListening() {
            if (!recognizer) await loadModel();
            if (isListening) return;
            isListening = true;

            recognizer.listen(result => {
                lastScores = result.scores.map(s => +(s*100).toFixed(2));
            }, {
                includeSpectrogram: true,
                probabilityThreshold: 0.0,
                overlapFactor: 0.5
            });

            // Update DOM every 10 sec
            setInterval(() => {
                if (!isListening) return;
                updateRadial('noise-progress', 'noise-text', lastScores[0]);
                updateRadial('human-progress', 'human-text', lastScores[1]);
                updateRadial('animal-progress', 'animal-text', lastScores[2]);
                updateRadial('wheeze-progress', 'wheeze-text', lastScores[3]);

                const maxIndex = lastScores.indexOf(Math.max(...lastScores));
                const recommendations = [
                    "Low biological sounds detected. Check mic positioning.",
                    "Human breathing sounds detected. Ensure minimal interference.",
                    "Small Animal normal breathing detected.",
                    "Wheezing detected! Immediate vet attention recommended."
                ];
                document.getElementById('recommendation-text').textContent = recommendations[maxIndex];
            }, 10000);
        }

        function stopListening() {
            if (!recognizer) return;
            recognizer.stopListening();
            isListening = false;
        }

        function updateRadial(elementId, textId, percentage) {
            const circle = document.getElementById(elementId);
            const text = document.getElementById(textId);
            const degrees = (percentage/100)*360;
            circle.style.background = `conic-gradient(#10B981 ${degrees}deg, #E5E7EB ${degrees}deg)`;
            text.textContent = `${percentage.toFixed(2)}%`;
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadModel();
            updateRadial('noise-progress', 'noise-text', 0);
            updateRadial('human-progress', 'human-text', 0);
            updateRadial('animal-progress', 'animal-text', 0);
            updateRadial('wheeze-progress', 'wheeze-text', 0);
        });

        // Tie your mic-button to startListening/stopListening
        document.querySelector('.mic-button').addEventListener('click', () => {
            if(isListening) stopListening();
            else startListening();
        });
    </script>
</body>
</html>

