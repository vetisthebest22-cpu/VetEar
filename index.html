<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VetPulse - AI Veterinary Sound Analysis</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Inter',sans-serif; background:#fff; min-height:100vh; position:relative; overflow-x:hidden; }
/* باقي CSS نفس اللي عندك ... */
.microphone-container { margin:2rem 0; text-align:center; position:relative; }
.countdown { margin-top:10px; font-weight:600; color:#7C3AED; font-size:1rem; }
.mic-button{ width:80px; height:80px; border-radius:50%; background:linear-gradient(135deg,#7C3AED,#10B981); border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; margin:0 auto; box-shadow:0 8px 25px rgba(124,58,237,0.3); transition:all 0.3s; animation:pulse 2s ease-in-out infinite; }
/* أضف بقية CSS كما هي بدون تعديل */
</style>
</head>
<body>

<!-- باقي التصميم كما هو -->

<section class="hero-section">
    <h1 class="hero-title">VetPulse AI Analysis</h1>
    <p class="hero-subtitle">Advanced veterinary sound analysis powered by AI</p>
    <div class="microphone-container">
        <button class="mic-button" onclick="toggleListening()" aria-label="Start audio analysis">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
            </svg>
        </button>
        <div class="countdown" id="countdown-text"></div>
    </div>
</section>

<!-- Analysis grid, descriptions, recommendations ... نفس الموجود -->

<!-- AI Popup -->
<div id="ai-popup"><strong>AI Analysis Result:</strong><p id="popup-text">Analyzing...</p></div>

<!-- Footer كما هو -->

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/audio@0.8/dist/teachablemachine-audio.min.js"></script>

<script>
let model, mic, isListening=false;

async function initAI() {
    const URL = './my model/'; // عدل هذا الرابط لمسار الموديل عندك
    model = await tmAudio.load(URL + 'model.json', URL + 'metadata.json');
    mic = await tmAudio.AudioListener.create();
}
initAI();

function updateProgress(elementId,textId,percentage){
    const circle=document.getElementById(elementId);
    const text=document.getElementById(textId);
    const degrees=(percentage/100)*360;
    circle.style.background=`conic-gradient(#10B981 ${degrees}deg,#E5E7EB ${degrees}deg)`;
    text.textContent=`${percentage}%`;
}

async function toggleListening(){
    const button=document.querySelector('.mic-button');
    const countdownEl=document.getElementById('countdown-text');

    if(!isListening){
        isListening=true;
        button.style.animation='pulse 0.5s ease-in-out infinite';
        button.style.background='linear-gradient(135deg,#10B981,#7C3AED)';
        countdownEl.textContent='Analyzing... 10';
        let seconds=10;

        try { await mic.start(); } catch(e){ console.error(e); }

        const interval=setInterval(()=>{
            seconds--;
            countdownEl.textContent='Analyzing... '+seconds;
            if(seconds<=0){ clearInterval(interval); countdownEl.textContent=''; stopListening(); }
        },1000);
    } else {
        stopListening();
    }
}

async function stopListening(){
    try { await mic.stop(); } catch(e){ console.error(e); }
    isListening=false;
    const button=document.querySelector('.mic-button');
    button.style.animation='pulse 2s ease-in-out infinite';
    button.style.background='linear-gradient(135deg,#7C3AED,#10B981)';
    runAnalysis();
}

async function runAnalysis(){
    const predictions = await model.predict(mic);
    // مثال: تحويل نتائج النموذج لنسب 0-100% عشوائياً (يمكنك تعديل حسب خروج النموذج الفعلي)
    const noise=Math.round(predictions[0].probability*100);
    const human=Math.round(predictions[1].probability*100);
    const animal=Math.round(predictions[2].probability*100);
    const wheeze=Math.round(predictions[3].probability*100);
    updateProgress('noise-progress','noise-text',noise);
    updateProgress('human-progress','human-text',human);
    updateProgress('animal-progress','animal-text',animal);
    updateProgress('wheeze-progress','wheeze-text',wheeze);

    const scenarioText = predictions.map(p=>p.className+' : '+Math.round(p.probability*100)+'%').join('<br>');
    document.getElementById('ai-popup').style.display='block';
    document.getElementById('popup-text').innerHTML = scenarioText;
}
</script>

</body>
</html>


