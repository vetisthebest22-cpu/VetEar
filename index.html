<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VetPulse - AI Veterinary Sound Analysis</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Inter',sans-serif; background:#fff; margin:0; padding:0; }
    .mic-button {
      width:80px;height:80px;border-radius:50%;
      background:linear-gradient(135deg,#7C3AED,#10B981);
      border:none;cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      margin:20px auto; box-shadow:0 8px 25px rgba(124,58,237,0.3);
      animation:pulse 2s ease-in-out infinite;
    }
    @keyframes pulse {
      0%,100%{box-shadow:0 8px 25px rgba(124,58,237,0.3),0 0 0 0 rgba(124,58,237,0.4);}
      50%{box-shadow:0 8px 25px rgba(124,58,237,0.3),0 0 0 20px rgba(124,58,237,0);}
    }
    .status { text-align:center; font-size:0.9rem; color:#6B7280; margin-top:8px; min-height:20px; }
    .progress-grid { display:grid;grid-template-columns:1fr 1fr;gap:1rem;max-width:600px;margin:2rem auto; }
    .progress-item { text-align:center; }
    .progress-circle {
      width:80px;height:80px;border-radius:50%;
      background:conic-gradient(#10B981 0deg,#E5E7EB 0deg);
      margin:0 auto;display:flex;align-items:center;justify-content:center;position:relative;
    }
    .progress-circle::before {
      content:'';position:absolute;width:60px;height:60px;background:#fff;border-radius:50%;
    }
    .progress-text { position:absolute;font-weight:700;color:#7C3AED; }
  </style>
</head>
<body>

  <h1 style="text-align:center;color:#7C3AED;margin-top:20px;">VetPulse AI Analysis</h1>

  <div style="text-align:center;">
    <button class="mic-button" onclick="toggleListening()">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
      </svg>
    </button>
    <div class="status" id="status-text"></div>
  </div>

  <div class="progress-grid">
    <div class="progress-item">
      <div class="progress-circle" id="noise-progress"><span class="progress-text" id="noise-text">0%</span></div>
      <p>Background Noise</p>
    </div>
    <div class="progress-item">
      <div class="progress-circle" id="human-progress"><span class="progress-text" id="human-text">0%</span></div>
      <p>Human - Normal</p>
    </div>
    <div class="progress-item">
      <div class="progress-circle" id="animal-progress"><span class="progress-text" id="animal-text">0%</span></div>
      <p>Small Animal - Normal</p>
    </div>
    <div class="progress-item">
      <div class="progress-circle" id="wheeze-progress"><span class="progress-text" id="wheeze-text">0%</span></div>
      <p>Wheezing</p>
    </div>
  </div>

  <p id="recommendation-text" style="text-align:center;font-weight:600;color:#374151;"></p>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/speech-commands@0.4.0/dist/speech-commands.min.js"></script>
  <script>
    let recognizer;
    let isListening = false;
    const URL = "./my_model/";

    async function createModel(){
      recognizer = speechCommands.create("BROWSER_FFT",undefined,URL+"model.json",URL+"metadata.json");
      await recognizer.ensureModelLoaded();
    }

    async function toggleListening(){
      const btn=document.querySelector('.mic-button');
      const status=document.getElementById('status-text');
      const recText=document.getElementById('recommendation-text');

      if(isListening){ // stop
        if(recognizer) recognizer.stopListening();
        isListening=false;
        btn.style.animation='pulse 2s ease-in-out infinite';
        btn.style.background='linear-gradient(135deg,#7C3AED,#10B981)';
        status.textContent="";
        return;
      }

      // start listening
      if(!recognizer) await createModel();
      isListening=true;
      btn.style.animation='pulse 0.5s ease-in-out infinite';
      btn.style.background='linear-gradient(135deg,#10B981,#7C3AED)';
      recText.textContent="";
      
      let countdown=10;
      status.textContent=`Analysing... ${countdown}s`;
      const timer=setInterval(()=>{
        countdown--;
        status.textContent=`Analysing... ${countdown}s`;
      },1000);

      let lastScores=[0,0,0,0];

      recognizer.listen(result=>{
        lastScores=result.scores;
        updateProgress('noise-progress','noise-text',Math.round(lastScores[0]*100));
        updateProgress('human-progress','human-text',Math.round(lastScores[1]*100));
        updateProgress('animal-progress','animal-text',Math.round(lastScores[2]*100));
        updateProgress('wheeze-progress','wheeze-text',Math.round(lastScores[3]*100));
      },{probabilityThreshold:0.5,overlapFactor:0.5});

      setTimeout(()=>{
        clearInterval(timer);
        recognizer.stopListening();
        isListening=false;
        btn.style.animation='pulse 2s ease-in-out infinite';
        btn.style.background='linear-gradient(135deg,#7C3AED,#10B981)';
        status.textContent="Analysis Complete";

        // Final recommendation
        let rec="Continue monitoring...";
        if(lastScores[3]>0.7) rec="⚠️ Wheezing detected! Recommend veterinary attention.";
        else if(lastScores[2]>0.8) rec="Healthy small animal with normal breathing.";
        recText.textContent=rec;
      },10000);
    }

    function updateProgress(circleId,textId,percent){
      const circle=document.getElementById(circleId);
      const text=document.getElementById(textId);
      const deg=(percent/100)*360;
      circle.style.background=`conic-gradient(#10B981 ${deg}deg,#E5E7EB ${deg}deg)`;
      text.textContent=`${percent}%`;
    }
  </script>
</body>
</html>


